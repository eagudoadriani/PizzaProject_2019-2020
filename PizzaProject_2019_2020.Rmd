---
title: "Effect of herbivory and nutrients on Galapagos' algae"
author: "Esteban Agudo"
date: "8/25/2020"
output:
  html_document:
    df_print: paged
  word_document: default
always_allow_html: yes
---

```{r, warning=FALSE, message=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggpubr)
library(viridis)
library(hrbrthemes)
library(gridExtra)
library(stats)
library(kableExtra)
library(flextable)
library(reshape2)
#library(xlsx)
library(cowplot)
library(performance)
library(MASS)
library(openxlsx)

```

# Effect of herbivore exclussion and Nutrient additions on algae cover.

##Cold season
Uploading data for the cold season, then preparing data for plotting. 
```{r}
cold_2019<-read.csv(file="AlgaeCover_Cold2019.csv", header=T)
cold_2019<-na.omit(cold_2019)
cold_2019$Week<-as.factor(cold_2019$Week)
cold_2019$Cage.Number<-as.factor(cold_2019$Cage.Number)

#Changing the names and reordering levels of the factor Nutrient additions.
cold_2019$N <- factor(cold_2019$N, levels = c("No N", "N+"))
levels(cold_2019$N) <- (c("No N" = "Ambient nutrients", "N+" = "Nutrient additions"))

#Reordering  the levels of the treatments
cold_2019$Treatment <- factor(cold_2019$Treatment, levels = c("All present", "Fish only", "Urchins Only", "None present"))

#Changing the name of the levels in treatment
levels(cold_2019$Treatment)<-(c("All present"="Open pizzas", "Fish only"="Fish access", "Urchins Only"="Fish exclusions", "None present"="Full exclusions"))
```

Estimating values and preparing plot. 
```{r, fig.height=5, fig.width=10}
cold_2019_average<-cold_2019 %>%
 dplyr::select(Cage.Number, Treatment, N, Week, Algae) %>%
group_by(Week,Treatment, N) %>%
summarise(mean=mean(Algae), se=sd(Algae)/sqrt(length(Algae))) %>%
  filter(Treatment!= "Fish access") #Removing fish treatment

# Ploting weekly changes for the cold season 
colour.palette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

Algae_CoverColdSeason <- ggplot(cold_2019_average, aes(x=Week, y=mean, colour=Treatment, group=Treatment)) + 
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.8, position=position_dodge(width=0.4), linetype="dotted", size=.4) +
  geom_line(position=position_dodge(width=0.4)) +
  geom_point(size = 2, position=position_dodge(width=0.4)) + 
  facet_wrap(~N, nrow=1) +theme_bw()+theme(legend.position = "bottom") +
  theme(panel.grid.major = element_blank(), panel.grid.minor=element_blank()) +
  labs(y="Mean algae cover (%)", x="Sampling week") +
  scale_color_manual(values=colour.palette)
```

### Plotting_COLD
```{r, fig.height=5, fig.width=10}
Algae_CoverColdSeason
#ggsave("AlgaeCover_ColdSeason.png", width = 20, height = 10, units = "cm", dpi = 300)
```
Figure 1: Effect of herbivore exclussion and Nutrient additions on weekly algae cover during cold season. 

## Warm season
Loading and preparing data of the warm season
```{r}
#Loading and preparing data
warm_2020<-read.csv(file="AlgaeCover_Warm2020.csv", header=T)
warm_2020<-na.omit(warm_2020)
warm_2020$Week<-as.factor(warm_2020$Week)
warm_2020$Cage.Number<-as.factor(warm_2020$Cage.Number)

#Changing the names and reordering levels of the factor Nutrient additions.
warm_2020$N <- factor(warm_2020$N, levels = c("No N", "N+"))
levels(warm_2020$N) <- (c("No N" = "Ambient nutrients", "N+" = "Nutrient additions"))

#Reordering  the levels of the treatments
warm_2020$Treatment <- factor(warm_2020$Treatment, levels = c("All present", "Urchins Only", "None present"))

#Changing the name of the levels in treatment
levels(warm_2020$Treatment)<-(c("All present"="Open pizzas", "Urchins Only"="Fish exclusions", "None present"="Full exclusions"))
```

### Plotting_WARM
```{r, fig.height=5, fig.width=10}
warm_2020_average <- warm_2020 %>%
  dplyr::select(Cage.Number, Treatment, N, Week, Algae) %>%
group_by(Week,Treatment, N) %>%
summarise(mean=mean(Algae), se=sd(Algae)/sqrt(length(Algae)))

AlgaeCover_HotSeason <- ggplot(warm_2020_average, aes(x=Week, y=mean, colour=Treatment, group=Treatment)) + 
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.8, position=position_dodge(width=0.4), linetype="dotted",size=.4)+
    geom_line(position=position_dodge(width=0.4)) +
    geom_point(size=2, position=position_dodge(width=0.4))+ facet_wrap(~N, nrow=1) +theme_bw()+theme(legend.position = "bottom")+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  labs(y="Mean algae cover (%)", x="Sampling week")+
  scale_color_manual(values=colour.palette)
```


```{r, fig.height=5, fig.width=10}
AlgaeCover_HotSeason
#ggsave("AlgaeCover_HotSeason.png", width = 18, height = 10, units = "cm", dpi = 300)
```
Figure 2: Effect of herbivore exclussion and Nutrient additions on algae cover during warm season. 


##Ploting both together 
```{r}
Cover_BothSeason <- ggarrange(Algae_CoverColdSeason, AlgaeCover_HotSeason, nrow=2, common.legend = TRUE, labels = c("A", "B"), hjust = -0.1, vjust = 1.5, legend="bottom") + 
  theme(plot.background = element_rect(fill = "white", colour = NA))
#ggsave("Cover_BothSeason.png", width = 18, height = 17, units = "cm", dpi = 300)

```


## Colleen stat exploration:
```{r cold season cover normal test}

## So these data are super non-normal! 
hist(cold_2019$Algae)
qqnorm(cold_2019$Algae)
qqline(cold_2019$Algae)
shapiro.test(cold_2019$Algae)

hist(warm_2020$Algae)
qqnorm(warm_2020$Algae)
qqline(warm_2020$Algae)
shapiro.test(warm_2020$Algae)

```


# Effect of herbivore's exclussion and Nutrient additions on algae weight.  

Data uploading and preparation including changing names and reordering factors.
```{r}
## Loading Cold season data
AlgaeWeight_Cold2019 <- read.csv(file = "AlgaeWeight_Cold2019.csv") 

#Reordering and renaming Factor: Nutrient
AlgaeWeight_Cold2019$N <- factor(AlgaeWeight_Cold2019$N, levels = c("No N", "N+"))
levels(AlgaeWeight_Cold2019$N) <- c("No N" = "Ambient nutrients", "N+" = "Nutrient additions")

#Reordering and renaming factor Treatment
AlgaeWeight_Cold2019$Treatment <- factor(AlgaeWeight_Cold2019$Treatment, levels = c("All present", "Fish Only", "Urchins Only", "None present"))
levels(AlgaeWeight_Cold2019$Treatment) <- (c("All present" = "Open pizzas", "Fish Only" = "Fish access", "Urchins Only" = "Fish exclusions", "None present" = "Full exclusions"))

AlgaeWeight_Cold2019 <- AlgaeWeight_Cold2019 %>%
  filter(Treatment != "Fish access") %>% #Removing exclussion treatment with access to fish
  filter(AFDW..g...preburn..postburn. != 0) %>% #Removing sampling units zeros
  droplevels()



## Loading Warm season data
AlgaeWeight_Warm2020 <- read.csv(file = "AlgaeWeight_Warm2020.csv") 

#Reordering and renaming Factor: Nutrient
AlgaeWeight_Warm2020$N <- factor(AlgaeWeight_Warm2020$N, levels = c("No N", "N+"))
levels(AlgaeWeight_Warm2020$N) <- c("No N" = "Ambient nutrients", "N+" = "Nutrient additions")

#Reordering and renaming factor Treatment
AlgaeWeight_Warm2020$Treatment <- factor(AlgaeWeight_Warm2020$Treatment, levels = c("All present", "Urchins Only", "None Present"))
levels(AlgaeWeight_Warm2020$Treatment) <- (c("All present"="Open pizzas", "Urchins Only"="Fish exclusions", "None Present"="Full exclusions"))

AlgaeWeight_Warm2020 <- AlgaeWeight_Warm2020 %>%
  filter(AFDW..g...preburn..postburn. != 0) # Removing zeros
 
```

```{r}
AlgaeWeight_Cold2019_Average <- AlgaeWeight_Cold2019 %>%
  group_by(Treatment, N) %>%
  summarise(Mean_AlgaeWeight=mean(AFDW..g...preburn..postburn.), 
            se=sd(AFDW..g...preburn..postburn.)/sqrt(length(AFDW..g...preburn..postburn.))) 

AlgaeWeight_Warm2020_Average <- AlgaeWeight_Warm2020 %>%
  group_by(Treatment, N) %>%
  summarise(Mean_AlgaeWeight=mean(AFDW..g...preburn..postburn.), 
            se=sd(AFDW..g...preburn..postburn.)/sqrt(length(AFDW..g...preburn..postburn.)))
```
### Ploting Box plots (using collen code)  for cold season 

```{r}
# Summarizing data for each plot in order
AlgaeWeight_Cold2019_sum <- AlgaeWeight_Cold2019 %>% 
  group_by(Treatment, N) %>% # input your grouping variable (seperate by commas if more than one)
  summarize(mean = round(mean(AFDW..g...preburn..postburn., na.rm = TRUE), 2),
            max = round(max(AFDW..g...preburn..postburn., na.rm = TRUE), 2),
            min = round(min(AFDW..g...preburn..postburn., na.rm = TRUE), 2),
            sd = sd(AFDW..g...preburn..postburn., na.rm = TRUE),
            n = n(),
          se=sd / sqrt(n))%>% 
  mutate(lowerci = mean - qt(1 - (0.05 / 2), n - 1) * se,
         upperci = mean + qt(1 - (0.05 / 2), n - 1) * se)

```

```{r}
X <- AlgaeWeight_Cold2019_sum$N # item to plot on x-axis
#df <- AlgaeWeight_Cold2019_sum # dataframe containing your summary stats
colour <- AlgaeWeight_Cold2019_sum$Treatment # item to colour data by  
overall.mean <- round(mean(AlgaeWeight_Cold2019$AFDW..g...preburn..postburn.), 2) # modify this to change location of dashed line
ylab <- "AFDW (g)" # input y-axis label here (put "" if you want to leave label blank)
xlab <- "" # input x-axis label here (put "" if you want to leave label blank)
title <- "" # overall plot title (put "" if no title)

colour.palette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
# This is just a nicer (colour blind friendly) colour palette that avoids defaults
```

### Plotting: Algae weight during cold season   

```{r}
P1 <- ggplot() +
  theme_bw() + # sets plot theme (removes gridlines, etc.)
  #geom_hline(yintercept = overall.mean, colour = "darkgrey", linetype = 2) + # dashed line
  geom_point(data = AlgaeWeight_Cold2019, aes(x =N , y = AFDW..g...preburn..postburn., colour = Treatment), shape = 1, alpha = 0.4,              position = position_jitterdodge(jitter.width = NULL, jitter.height = 0,dodge.width = 0.85)) +
  geom_errorbar(data = AlgaeWeight_Cold2019_sum, aes(x = X, ymin = mean-se, ymax = mean+se, colour = colour), size = 8, width = 0, alpha = 0.6, position = position_dodge(width = 0.85), show.legend = FALSE) + # this plots SE behind the mean, can use also CI with summarize
  geom_point(data = AlgaeWeight_Cold2019_sum, aes(x = X, y = mean, colour = colour), shape = "-", size = 20, position = position_dodge(width = 0.85)) + # plots the mean value 
  scale_colour_manual(name = "", values = colour.palette) + # adds the colours for plotting
  ylab(ylab) + # y-axis label
  scale_y_continuous(expand=c(0,0), breaks=seq(0, 50, 10), limits = c(0, 50)) + # makes the y-axis display
  xlab(xlab) + # x-axis label
  ggtitle(title)+ # whole plot title
  theme(axis.text.x = element_text(size = 9.5),
        axis.title.y = element_text(size = 9.5, hjust = 0.6, vjust = 2.5),
        legend.position = "bottom", 
        legend.text = element_text(size = 10),  
        legend.key.size = unit(0.5, "cm"),
        legend.key.height = unit(0.5, "cm"),
        panel.grid = element_blank()) + #Legend theme
  guides(colour = guide_legend(override.aes = list(shape = 15, size=3)))
```

### Plotting effect herbivory and Nutrient additions on algae weight during warm season
```{r}
# summarizing
AlgaeWeight_Warm2020_sum <- AlgaeWeight_Warm2020 %>% 
  group_by(Treatment, N) %>% # input your grouping variable (seperate by commas if more than one)
  summarize(mean = round(mean(AFDW..g...preburn..postburn., na.rm = TRUE), 2),
            max = round(max(AFDW..g...preburn..postburn., na.rm = TRUE), 2),
            min = round(min(AFDW..g...preburn..postburn., na.rm = TRUE), 2),
            sd = sd(AFDW..g...preburn..postburn., na.rm = TRUE),
            n = n(),
            se=sd/sqrt(n)) %>% 
  mutate(lowerci = mean - qt(1 - (0.05 / 2), n - 1) * se,
         upperci = mean + qt(1 - (0.05 / 2), n - 1) * se)

```

Estimating values for plot
```{r}
X <- AlgaeWeight_Warm2020_sum$N # item to plot on x-axis
#df <- AlgaeWeight_Warm2020_sum # dataframe containing your summary stats
colour <- AlgaeWeight_Warm2020_sum$Treatment # item to colour data by  
overall.mean <- round(mean(AlgaeWeight_Warm2020$AFDW..g...preburn..postburn.), 2) # modify this to change location of dashed line
ylab <- "AFDW (g)" # input y-axis label here (put "" if you want to leave label blank)
xlab <- "" # input x-axis label here (put "" if you want to leave label blank)
title <- "" # overall plot title (put "" if no title)

colour.palette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
# This is just a nicer (colour blind friendly) colour palette that avoids defaults
```

Let's build the same plot fot the warm season  
```{r}
P2 <- ggplot() +
  theme_bw() + # sets plot theme (removes gridlines, etc.)
  theme(panel.border = element_rect(colour = "black", fill=NA, size=0.7)) + # adds box around plot area
  #geom_hline(yintercept = overall.mean, colour = "darkgrey", linetype = 2) + # dashed line
  geom_point(data = AlgaeWeight_Warm2020, aes(x =N , y = AFDW..g...preburn..postburn., colour = Treatment), shape = 1, alpha = 0.4,              position = position_jitterdodge(jitter.width = NULL, jitter.height = 0,dodge.width = 0.85)) +
  geom_errorbar(data = AlgaeWeight_Warm2020_sum, aes(x = X, ymin = mean-se, ymax = mean+se, colour = colour), size = 8, width = 0, alpha = 0.6, position = position_dodge(width = 0.85), show.legend = FALSE) + # this plots SE behind the mean-Can change a CI using CI in summarize
  geom_point(data = AlgaeWeight_Warm2020_sum, aes(x = X, y = mean, colour = colour), shape = "-", size = 20, position = position_dodge(width = 0.85)) + # plots the mean value 
  scale_colour_manual(name = "", values = colour.palette) + # adds the colours for plotting
  ylab(ylab) + # y-axis label
  scale_y_continuous(expand=c(0,0), breaks=seq(0, 50, 10), limits = c(0, 50)) + # makes the y-axis display
  xlab(xlab) + # x-axis label
  ggtitle(title)+ #legend theme
  theme(axis.text.x = element_text(size = 9.5),
        axis.title.y = element_text(size = 9.5, hjust = 0.6, vjust = 2.5),
        legend.position = "bottom", 
        legend.text = element_text(size = 10),  
        legend.key.size = unit(0.5, "cm"),
        legend.key.height = unit(0.5, "cm"),
        panel.grid = element_blank()) + #Legend theme
    guides(colour = guide_legend(override.aes = list(shape = 15, size=3)))#Legend them
```

Comparison between the effect of herbivore exclussion and Nutrient additions across cold season and warm season. 
```{r}
Algae_weight <- ggarrange(P1, P2, nrow=1, common.legend = TRUE, labels = c("Cold Season", "Warm Season"), legend = "bottom") + 
  theme(plot.background = element_rect(fill = "white", colour = NA))
Algae_weight

#ggsave("AlgaeWeights_se.png", width = 22, height = 10, units = "cm", dpi = 300)
```


## Analysis of effect between herbivore exclussion and nutriend addition on algae weight

Let's start by checking data distribution:

```{r}
hist(AlgaeWeight_Cold2019$AFDW..g...preburn..postburn.)
hist(AlgaeWeight_Warm2020$AFDW..g...preburn..postburn.)

#It is slightly skewed so a sqrt transformation can do the job
hist(log(AlgaeWeight_Cold2019$AFDW..g...preburn..postburn.))
hist(sqrt(AlgaeWeight_Cold2019$AFDW..g...preburn..postburn.))

qqnorm(sqrt(AlgaeWeight_Cold2019$AFDW..g...preburn..postburn.))
qqline(sqrt(AlgaeWeight_Cold2019$AFDW..g...preburn..postburn.))

qqnorm(log(AlgaeWeight_Cold2019$AFDW..g...preburn..postburn.+0.001))
qqline(log(AlgaeWeight_Cold2019$AFDW..g...preburn..postburn.+0.001))

shapiro.test(AlgaeWeight_Cold2019$AFDW..g...preburn..postburn.)
shapiro.test(sqrt(AlgaeWeight_Cold2019$AFDW..g...preburn..postburn.))
#still not normal

#It is severe skewed so we can do a log10 transformation
hist(log10(AlgaeWeight_Warm2020$AFDW..g...preburn..postburn.))
shapiro.test(AlgaeWeight_Warm2020$AFDW..g...preburn..postburn.)
shapiro.test(sqrt(AlgaeWeight_Warm2020$AFDW..g...preburn..postburn.))
```
Even after transformation data does not seems to resemble normality so we should not use an Anova or any other parametric test. 

### Determine effect of herbivory and nutriend addition using a GLM 
```{r}
# Let's try with a  glm using a gamma distribution. 

cold_season_model_gamma <- glm((AFDW..g...preburn..postburn.) ~ Treatment * N, family = Gamma(link = "log"), data = AlgaeWeight_Cold2019)
summary(cold_season_model_gamma)

# Let's build a similar model without the interaction
cold_season_model_gamma_NI<-glm((AFDW..g...preburn..postburn.) ~ Treatment + N, family = Gamma(link = "log"), data = AlgaeWeight_Cold2019)
summary(cold_season_model_gamma_NI)

#Comparing models with and without interaction
anova(cold_season_model_gamma, cold_season_model_gamma_NI, test = 'Chisq')
anova(cold_season_model_gamma, test = 'Chisq') 

##Building a similar model for the warm season

# need to remove Fish exclusions here before running model
AlgaeWeight_Warm2020_fishRM <- AlgaeWeight_Warm2020 %>%
  filter(Treatment %in% c("Open pizzas", "Full exclusions")) %>% 
  droplevels()

warm_season_model_gamma <- glm((AFDW..g...preburn..postburn.) ~ Treatment * N, family = Gamma(link="log"), data = AlgaeWeight_Warm2020_fishRM)
summary(warm_season_model_gamma)

```

### Putting results from gamma model in a table
```{r}
#Let's build the table for the model with the gamma distribution
summary(cold_season_model_gamma)

Estimate<-coef(summary(cold_season_model_gamma))[,1]
Std.Error<-coef(summary(cold_season_model_gamma))[,2]
t.value<-coef(summary(cold_season_model_gamma))[,3]
P.value<-coef(summary(cold_season_model_gamma))[,4]
Treatment<-c("(Intercept)", "Urchin acces", "Full exclusions", "Nutrient additions", "Urchin access x Nutrient additions", "Full exclusions x Nutrient additions")

cold_gamma_table<-data.frame(Treatment, Estimate, Std.Error, t.value, P.value)

cold_gamma_table$Signif.<-ifelse(cold_gamma_table$P.value<0.05, "*", "") 
#cold_gamma_table$Signif.<-ifelse(cold_gamma_table$P.value<0.01 & cold_gamma_table$P.value>0.001, "**", "") 
#cold_gamma_table$Signif.<-ifelse(cold_gamma_table$P.value<0.001, "***", "") 

cold_gamma_table<-cold_gamma_table %>% 
  mutate_if(is.numeric, round, digits=3) 

cold_gamma_table$P.value[cold_gamma_table$P.value<=0.05]<-">0.05"
#cold_gamma_table$P.value[cold_gamma_table$P.value<=0.01 & cold_gamma_table$P.value > 0.001 ]<-">0.01"
#cold_gamma_table$P.value[cold_gamma_table$P.value<=0.001]<-">0.001"

cold_gamma_table<- flextable(cold_gamma_table)
cold_gamma_table<-autofit(cold_gamma_table)
cold_gamma_table<-font(cold_gamma_table, fontname = "Times", part = "header")
cold_gamma_table<-font(cold_gamma_table, fontname = "Times")
cold_gamma_table <- add_header_lines(cold_gamma_table, values = "Cold season")
save_as_image(cold_gamma_table, path = "cold_gamma_table.png")
cold_gamma_table



#Let's do the same for the warm season 

summary(warm_season_model_gamma)

Estimate<-coef(summary(warm_season_model_gamma))[,1]
Std.Error<-coef(summary(warm_season_model_gamma))[,2]
t.value<-coef(summary(warm_season_model_gamma))[,3]
P.value<-coef(summary(warm_season_model_gamma))[,4]
Treatment<-c("(Intercept)", "Full exclusions", "Nutrient additions", "Full exclusions x Nutrient additions")
#Treatment<-c("(Intercept)", "Urchin acces", "Full exclusions", "Nutrient additions", "Urchin access x Nutrient additions", "Full exclusions x Nutrient additions")

warm_gamma_table<-data.frame(Treatment, Estimate, Std.Error, t.value, P.value)

warm_gamma_table$Signif.<-ifelse(warm_gamma_table$P.value<0.05, "*", "") 

warm_gamma_table<-warm_gamma_table %>% 
  mutate_if(is.numeric, round, digits=3) 

warm_gamma_table$P.value[warm_gamma_table$P.value<=0.05]<-">0.05"
#warm_anova_table$P.value[warm_anova_table$P.value<=0.01]<-">0.01"

warm_gamma_table<- flextable(warm_gamma_table)
warm_gamma_table<-autofit(warm_gamma_table)
warm_gamma_table<-font(warm_gamma_table, fontname = "Times", part = "header")
warm_gamma_table<-font(warm_gamma_table, fontname = "Times")
warm_gamma_table <- add_header_lines(warm_gamma_table, values = "Warm season")
save_as_image(warm_gamma_table, path = "warm_gamma_table.png")
warm_gamma_table
```

## Colleen's suggested bootstrapping method:

```{r bootstrap setup_2}

# set seed for reproducibility 
set.seed(16)

### Setup the bootstrap function and number of iterations

# This is a bootstrap function that will sample WITH replacement (explained step by step within the function)
bootFUN <- function(model, newdata) {
  if(class(model)[1] == "negbin"){
    nr <- nrow(model[["model"]]) # count number of rows in the model (# of observations)
    data <- model[["model"]] # pull data from model
  } else {
    nr <- nrow(model$data) # count number of rows in the model (# of observations)
    data <- model$data # pull data from model
  }
  data2 <- data.frame(data[sample(1:nr, replace = TRUE), ]) # random sample of numbers from 1 - nr (# of rows) to select data from
  update <- update(model, data = data2) # rerun the model using the 'new' dataset from the random smapling above
  predict(update, newdata, type = "response", level = 0.95) # predicts response variable with model and updated data 
}

bootnum <- 1000 # this is the number of bootstrap replicates. I set it to 1500 here but we should select a number between 999 and 9999

```

### Warm Season
```{r warm season bootstraping}

## Warm season GLM (I removed the +0.01 since you do not have any 0s here)
warm_glm <- glm(AFDW..g...preburn..postburn. ~ Treatment * N, family = Gamma(link = "log"), data = AlgaeWeight_Warm2020_fishRM)

## Run parametric bootstrapping:
newdata <- data.frame(Treatment = AlgaeWeight_Warm2020_fishRM$Treatment, N = AlgaeWeight_Warm2020_fishRM$N) # creates dataframe of predictor variables (here, Treatment and N)
boot <- replicate(bootnum, bootFUN(model = warm_glm, newdata = newdata)) # run the bootFUN the number (bootnum) of times specified and save as matrix

# Calculate the mean, 95% lowerCI, and 95% upperCI from the boot matrix and add it to dataframe (but as a new name)
AlgaeWeight_Warm2020_boot <- cbind(AlgaeWeight_Warm2020_fishRM, as.data.frame(t(apply(boot, 1, function(x) c(quantile(x, c(0.025, 0.5, 0.975)))))))
colnames(AlgaeWeight_Warm2020_boot)[13:15] <- c("lowerci", "mean", "upperci") # rename mean/CI columns

```

```{r warm season boot plot}

colour.palette <- c("#999999", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

AlgaeWeight_Warm2020_boot_fishRM <- AlgaeWeight_Warm2020_boot %>%
  filter(Treatment %in% c("Open pizzas", "Full exclusions")) %>% 
  droplevels()

levels(AlgaeWeight_Warm2020_boot_fishRM$N) <- c("No N" = "Ambient nutrients", "N+" = "Nutrient additions")

### Plot the observational values and bootstrapped mean/CI
warm_boot_plot <- ggplot() +
  geom_point(data = AlgaeWeight_Warm2020_boot_fishRM, aes(x = N , y = AFDW..g...preburn..postburn., colour = Treatment), shape = 1, alpha = 0.4, position = position_jitterdodge(jitter.width = NULL, jitter.height = 0, dodge.width = 0.85)) +
  geom_linerange(data = AlgaeWeight_Warm2020_boot_fishRM, aes(x = N, ymin = lowerci, ymax = upperci, colour = Treatment), alpha = 0.1, size = 8, position = position_dodge(width = 0.85)) +
  geom_point(data = AlgaeWeight_Warm2020_boot_fishRM, aes(x = N, y = mean, colour = Treatment), shape = "-", size = 20, position = position_dodge(width = 0.85)) + # plots the mean value 
  theme_bw() +
  theme(panel.grid = element_blank(), panel.background=element_blank(), legend.key=element_blank(), strip.background = element_blank())+
  scale_colour_manual(name = "", values = colour.palette) + # adds the colours for plotting
  #scale_y_continuous(expand=c(0,0), limits = c(-3, 120)) + # makes the y-axis display as $
  theme(axis.text.x = element_text(size = 9.5), axis.title.y = element_text(size = 9.5, hjust = 0.6, vjust = 2.5), legend.position = "bottom", legend.text = element_text(size = 8), legend.key.size = unit(0.4, "cm"), legend.key.height = unit(0.4, "cm")) + #Legend theme
  guides(colour = guide_legend(override.aes = list(shape = 15, size=3))) +
  ylab("AFDW (g)") + # y-axis label
  xlab("") +
  ggtitle("Warm Season") 

```

### Cold Season
```{r cold season bootstraping}

## Cold season GLM (I removed the +0.01 since you do not have any 0s here)

cold_glm <- glm(AFDW..g...preburn..postburn. ~ Treatment * N, family = Gamma(link = "log"), data = AlgaeWeight_Cold2019)

## Run parametric bootstrapping:
newdata <- data.frame(Treatment = AlgaeWeight_Cold2019$Treatment, N = AlgaeWeight_Cold2019$N) # creates dataframe of predictor variables (here, Treatment and N)
boot <- replicate(bootnum, bootFUN(model = cold_glm, newdata = newdata)) # run the bootFUN the number (bootnum) of times specified and save as matrix

# Calculate the mean, 95% lowerCI, and 95% upperCI from the boot matrix and add it to dataframe (but as a new name)
#AlgaeWeight_Cold2019_boot <- cbind(AlgaeWeight_Cold2019, as.data.frame(t(apply(boot, 1, function(x) c(quantile(x, c(0.025, 0.5, 0.975)))))))]
#colnames(AlgaeWeight_Cold2019_boot)[13:15] <- c("lowerci", "mean", "upperci") # rename mean/CI columns
AlgaeWeight_Cold2019_boot <- cbind(AlgaeWeight_Cold2019, as.data.frame(t(apply(boot, 1, function(x) c(quantile(x, c(0.025, 0.5, 0.975)))))))
colnames(AlgaeWeight_Cold2019_boot)[13:15] <- c("lowerci", "mean", "upperci") # rename mean/CI columns

```

```{r cold season boot plot}
colour.palette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

### Plot the observational values and bootstrapped mean/CI

#Include this to modify and remove urchin access

cold_boot_plot <- ggplot() +
  geom_point(data = AlgaeWeight_Cold2019_boot, aes(x = N , y = AFDW..g...preburn..postburn., colour = Treatment), shape = 1, alpha = 0.4, position = position_jitterdodge(jitter.width = NULL, jitter.height = 0,dodge.width = 0.85)) +
  geom_linerange(data = AlgaeWeight_Cold2019_boot, aes(x = N, ymin = lowerci, ymax = upperci, colour = Treatment), alpha = 0.1, size = 8, position = position_dodge(width = 0.85)) +
  geom_point(data = AlgaeWeight_Cold2019_boot, aes(x = N, y = mean, colour = Treatment), shape = "-", size = 20, position = position_dodge(width = 0.85)) + # plots the mean value 
  theme_bw() +
  theme(panel.grid = element_blank(), panel.background=element_blank(), legend.key=element_blank(), strip.background = element_blank())+
  scale_colour_manual(name = "", values = colour.palette) + # adds the colours for plotting
  #scale_y_continuous(expand=c(0,0), limits = c(-3, 120)) + # makes the y-axis display as $
  theme(axis.text.x = element_text(size = 9.5), axis.title.y = element_text(size = 9.5, hjust = 0.6, vjust = 2.5), legend.position = "bottom", legend.text = element_text(size = 8), legend.key.size = unit(0.4, "cm"), legend.key.height = unit(0.4, "cm")) + #Legend theme
  guides(colour = guide_legend(override.aes = list(shape = 15, size=3))) +
  ylab("AFDW (g)") + # y-axis label
  xlab("") +
  ggtitle("Cool Season")

```


### Cold and warm Bootstrap CI plot_AB

```{r combined CI plot}

AlgaeWeight_bootCI <- ggarrange(cold_boot_plot, warm_boot_plot, nrow = 1, labels = c("A", "B "), legend = "bottom", common.legend = TRUE) + 
  theme(plot.background = element_rect(fill = "white", colour = NA))
AlgaeWeight_bootCI

ggsave("Figure4_AlgaeWeight_bootCI.png", width = 22, height = 10, units = "cm", dpi = 300)

```



## Suplementary information 

### Procedural Control of warm season (Figure S2)
```{r procedural control bootstraping}

# need to remove Fish exclusions here before running model
AlgaeWeight_Warm2020_control <- AlgaeWeight_Warm2020 %>%
  filter(Treatment %in% c("Open pizzas", "Fish exclusions")) %>% 
  droplevels()

levels(AlgaeWeight_Warm2020_control$Treatment) <- c("Open pizzas" = "Open pizzas", "Fish exclusions" = "Procedural controls")



## Warm season GLM (I removed the +0.01 since you do not have any 0s here)
warm_control_glm <- glm(AFDW..g...preburn..postburn. ~ Treatment * N, family = Gamma(link = "log"), data = AlgaeWeight_Warm2020_control)

## Run parametric bootstrapping:
newdata <- data.frame(Treatment = AlgaeWeight_Warm2020_control$Treatment, N = AlgaeWeight_Warm2020_control$N) # creates dataframe of predictor variables (here, Treatment and N)
boot <- replicate(bootnum, bootFUN(model = warm_control_glm, newdata = newdata)) # run the bootFUN the number (bootnum) of times specified and save as matrix

# Calculate the mean, 95% lowerCI, and 95% upperCI from the boot matrix and add it to dataframe (but as a new name)
#AlgaeWeight_Warm2020_control_boot <- cbind(AlgaeWeight_Warm2020_control, as.data.frame(t(apply(boot, 1, function(x) c(quantile(x, c(0.025, 0.5, 0.975)))))))
#colnames(AlgaeWeight_Warm2020_control_boot)[13:15] <- c("lowerci", "mean", "upperci") # rename mean/CI columns

AlgaeWeight_Warm2020_control_boot <- cbind(AlgaeWeight_Warm2020_control, as.data.frame(t(apply(boot, 1, function(x) c(quantile(x, c(0.025, 0.5, 0.975)))))))
colnames(AlgaeWeight_Warm2020_control_boot)[13:15] <- c("lowerci", "mean", "upperci") # rename mean/CI columns


```

```{r procedural control boot plot}

colour.palette <- c("#999999", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

levels(AlgaeWeight_Warm2020_control_boot$N) <- c("No N" = "Ambient nutrients", "N+" = "Nutrient additions")

### Plot the observational values and bootstrapped mean/CI
warm_control_boot_plot <- ggplot() +
  geom_point(data = AlgaeWeight_Warm2020_control_boot, aes(x = N , y = AFDW..g...preburn..postburn., colour = Treatment), shape = 1, alpha = 0.4, position = position_jitterdodge(jitter.width = NULL, jitter.height = 0, dodge.width = 0.85)) +
  geom_linerange(data = AlgaeWeight_Warm2020_control_boot, aes(x = N, ymin = lowerci, ymax = upperci, colour = Treatment), alpha = 0.1, size = 8, position = position_dodge(width = 0.85)) +
  geom_point(data = AlgaeWeight_Warm2020_control_boot, aes(x = N, y = mean, colour = Treatment), shape = "-", size = 20, position = position_dodge(width = 0.85)) + # plots the mean value 
  theme_bw() +
  theme(panel.grid = element_blank(), panel.background=element_blank(), legend.key=element_blank(), strip.background = element_blank())+
  scale_colour_manual(name = "", values = colour.palette) + # adds the colours for plotting
  #scale_y_continuous(expand=c(0,0), limits = c(-3, 120)) + # makes the y-axis display as $
  theme(axis.text.x = element_text(size = 9.5), axis.title.y = element_text(size = 9.5, hjust = 0.6, vjust = 2.5), legend.position = "bottom", legend.text = element_text(size = 8), legend.key.size = unit(0.4, "cm"), legend.key.height = unit(0.4, "cm")) + #Legend theme
  guides(colour = guide_legend(override.aes = list(shape = 15, size=3))) +
  ylab("AFDW (g)") + # y-axis label
  xlab("") +
  ggtitle("Warm Season") 

```

```{r}
warm_control_boot_plot
ggsave("FigureS2_WarmProceduralControl.png", width = 14, height = 12, units = "cm", dpi = 300)
```


### Percent Algal Cover (Figure S3)
```{r run cool season % cover boot}

cold_2019_update <- cold_2019 %>% 
  filter(Treatment!= "Fish access") # remove fish treatment


## Cold season GLM for algal cover
cold_cover_glm <- glm(Algae ~ Treatment * Week + N, quasipoisson(link = "sqrt"), data = cold_2019_update)
summary(cold_cover_glm)

## Run parametric bootstrapping:
newdata <- data.frame(Treatment = cold_2019_update$Treatment, Week = cold_2019_update$Week, N = cold_2019_update$N) # creates dataframe of predictor variables (here, Treatment and N)
boot_cover <- replicate(bootnum, bootFUN(model = cold_cover_glm, newdata = newdata)) # run the bootFUN the number (bootnum) of times specified and save as matrix

# Calculate the mean, 95% lowerCI, and 95% upperCI from the boot_cover matrix and add it to dataframe (but as a new name)
cold_2019_boot <- cbind(cold_2019_update, as.data.frame(t(apply(boot_cover, 1, function(x) c(quantile(x, c(0.025, 0.5, 0.975)))))))
colnames(cold_2019_boot)[21:23] <- c("lowerci", "mean", "upperci") # rename mean/CI columns

```

```{r plot cool season per cover boot, echo=FALSE}

colour.palette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

# Plot cool season percent algal cover
Algae_CoverCoolSeason_boot <- ggplot(cold_2019_boot, aes(x=Week, y=mean, colour=Treatment, group=Treatment)) + 
  geom_errorbar(aes(ymin=lowerci, ymax=upperci), width=.8, position=position_dodge(width=0.4), linetype="dotted", size=.4)+
  geom_line(position=position_dodge(width=0.4)) +
  geom_point(size = 2, position=position_dodge(width=0.4))+ 
  facet_wrap(~N, nrow=1) +
  theme_bw()+
  theme(legend.position = "bottom")+ 
  theme(panel.grid.major = element_blank(), panel.grid.minor=element_blank())+
  labs(y="Mean algae cover (%)", x="Sampling week")+
  scale_color_manual(values=colour.palette)


Algae_CoverCoolSeason_boot
#ggsave("Algae_CoverCoolSeason_boot.png", width = 22, height = 10, units = "cm", dpi = 300)

```


```{r run warm season % cover boot}

warm_2020_update <- warm_2020

## Warm season GLM for algal cover
warm_cover_glm <- glm(Algae ~ Treatment + Week + N, family = quasipoisson(link = "sqrt"), data = warm_2020_update)
summary(warm_cover_glm)

## Run parametric bootstrapping:
newdata <- data.frame(Treatment = warm_2020_update$Treatment, Week = warm_2020_update$Week, N = warm_2020_update$N) # creates dataframe of predictor variables (here, Treatment and N)
boot_cover2 <- replicate(1500, bootFUN(model = warm_cover_glm, newdata = newdata)) # run the bootFUN the number (bootnum) of times specified and save as matrix

# Calculate the mean, 95% lowerCI, and 95% upperCI from the boot_cover matrix and add it to dataframe (but as a new name)
warm_2020_boot <- cbind(warm_2020_update, as.data.frame(t(apply(boot_cover2, 1, function(x) c(quantile(x, c(0.025, 0.5, 0.975)))))))
colnames(warm_2020_boot)[19:21] <- c("lowerci", "mean", "upperci") # rename mean/CI columns

```

```{r plot warm season per cover boot, echo=FALSE}

AlgaeWeight_Warm2020_boot_NU<-AlgaeWeight_Warm2020_boot %>%
  filter(Treatment %in% c("Open pizzas", "Full exclusions"))


# Plot warm season percent algal cover
Algae_CoverwarmSeason_boot <- ggplot(warm_2020_boot, aes(x=Week, y=mean, colour=Treatment, group=Treatment)) + 
  geom_errorbar(aes(ymin=lowerci, ymax=upperci), width=.8, position=position_dodge(width=0.4), linetype="dotted", size=.4)+
  geom_line(position=position_dodge(width=0.4)) +
  geom_point(size = 2, position=position_dodge(width=0.4))+ 
  facet_wrap(~N, nrow=1) +theme_bw()+theme(legend.position = "bottom")+ theme(panel.grid.major = element_blank(), panel.grid.minor=element_blank())+
  labs(y="Mean algae cover (%)", x="Sampling week")+
  scale_color_manual(values=colour.palette)


Algae_CoverwarmSeason_boot
# ggsave("AlgaeCover_WarmSeason_boot.png", width = 22, height = 10, units = "cm", dpi = 300)

```


```{r combine and save perc cover plot}

AlgaeCover_BothSeason_Boot <- ggarrange(Algae_CoverCoolSeason_boot, Algae_CoverwarmSeason_boot, nrow=2, common.legend = TRUE, labels = c("A", "B"), hjust = -0.1, vjust = 1.5, legend="bottom") + 
  theme(plot.background = element_rect(fill = "white", colour = NA))

AlgaeCover_BothSeason_Boot
ggsave("FigureS3_ComparationAlgaeCover_boot.png", width = 20, height = 20, units = "cm", dpi = 300)

```


### Algal AFDW per day (Figure S5)
```{r cool season AFDW per day}

## Cool season experiment lasted 126 days

## Calculate AFDW per day for cool season
AlgaeWeight_Cold2019$AFDW_perday <- (AlgaeWeight_Cold2019$AFDW..g...preburn..postburn. / 126)


## Cool season GLM and bootstrap
cool_perday_glm <- glm(AFDW_perday ~ Treatment * N, family = Gamma(link = "log"), data = AlgaeWeight_Cold2019)

## Run parametric bootstrapping:
newdata <- data.frame(Treatment = AlgaeWeight_Cold2019$Treatment, N = AlgaeWeight_Cold2019$N) # creates dataframe of predictor variables (here, Treatment and N)
boot <- replicate(bootnum, bootFUN(model = cool_perday_glm, newdata = newdata)) # run the bootFUN the number (bootnum) of times specified and save as matrix

# Calculate the mean, 95% lowerCI, and 95% upperCI from the boot matrix and add it to dataframe (but as a new name)
AlgaeWeight_Cold2019_perday_boot <- cbind(AlgaeWeight_Cold2019, as.data.frame(t(apply(boot, 1, function(x) c(quantile(x, c(0.025, 0.5, 0.975)))))))
colnames(AlgaeWeight_Cold2019_perday_boot)[14:16] <- c("lowerci", "mean", "upperci") # rename mean/CI columns



### Plot the observational values and bootstrapped mean/CI
cool_perday_boot_plot <- ggplot() +
  geom_point(data = AlgaeWeight_Cold2019_perday_boot, aes(x = N , y = AFDW_perday, colour = Treatment), shape = 1, alpha = 0.4, position = position_jitterdodge(jitter.width = NULL, jitter.height = 0, dodge.width = 0.85)) +
  geom_linerange(data = AlgaeWeight_Cold2019_perday_boot, aes(x = N, ymin = lowerci, ymax = upperci, colour = Treatment), alpha = 0.1, size = 8, position = position_dodge(width = 0.85)) +
  geom_point(data = AlgaeWeight_Cold2019_perday_boot, aes(x = N, y = mean, colour = Treatment), shape = "-", size = 20, position = position_dodge(width = 0.85)) + # plots the mean value 
  theme_bw() +
  theme(panel.grid = element_blank(), panel.background=element_blank(), legend.key=element_blank(), strip.background = element_blank())+
  scale_colour_manual(name = "", values = c("#999999", "#E69F00", "#56B4E9")) + # adds the colours for plotting
  #scale_y_continuous(expand=c(0,0), limits = c(-3, 120)) + # makes the y-axis display as $
  theme(axis.text.x = element_text(size = 9.5), axis.title.y = element_text(size = 9.5, hjust = 0.6, vjust = 2.5), legend.position = "bottom", legend.text = element_text(size = 8), legend.key.size = unit(0.4, "cm"), legend.key.height = unit(0.4, "cm")) + #Legend theme
  guides(colour = guide_legend(override.aes = list(shape = 15, size=3))) +
  ylab("AFDW per day (g)") + # y-axis label
  xlab("") +
  ggtitle("Cool Season") 

```

```{r warm season AFDW per day}

#### Warm season experiment lasted 46 days

## Calculate AFDW per day for warm season
AlgaeWeight_Warm2020_fishRM$AFDW_perday <- (AlgaeWeight_Warm2020_fishRM$AFDW..g...preburn..postburn. / 46)


## Warm season GLM and bootstrap
warm_perday_glm <- glm(AFDW_perday ~ Treatment * N, family = Gamma(link = "log"), data = AlgaeWeight_Warm2020_fishRM)

## Run parametric bootstrapping:
newdata <- data.frame(Treatment = AlgaeWeight_Warm2020_fishRM$Treatment, N = AlgaeWeight_Warm2020_fishRM$N) # creates dataframe of predictor variables (here, Treatment and N)
boot <- replicate(bootnum, bootFUN(model = warm_perday_glm, newdata = newdata)) # run the bootFUN the number (bootnum) of times specified and save as matrix

# Calculate the mean, 95% lowerCI, and 95% upperCI from the boot matrix and add it to dataframe (but as a new name)
AlgaeWeight_Warm2020_perday_boot <- cbind(AlgaeWeight_Warm2020_fishRM, as.data.frame(t(apply(boot, 1, function(x) c(quantile(x, c(0.025, 0.5, 0.975)))))))
colnames(AlgaeWeight_Warm2020_perday_boot)[14:16] <- c("lowerci", "mean", "upperci") # rename mean/CI columns



### Plot the observational values and bootstrapped mean/CI
warm_perday_boot_plot <- ggplot() +
  geom_point(data = AlgaeWeight_Warm2020_perday_boot, aes(x = N , y = AFDW_perday, colour = Treatment), shape = 1, alpha = 0.4, position = position_jitterdodge(jitter.width = NULL, jitter.height = 0, dodge.width = 0.85)) +
  geom_linerange(data = AlgaeWeight_Warm2020_perday_boot, aes(x = N, ymin = lowerci, ymax = upperci, colour = Treatment), alpha = 0.1, size = 8, position = position_dodge(width = 0.85)) +
  geom_point(data = AlgaeWeight_Warm2020_perday_boot, aes(x = N, y = mean, colour = Treatment), shape = "-", size = 20, position = position_dodge(width = 0.85)) + # plots the mean value 
  theme_bw() +
  theme(panel.grid = element_blank(), panel.background=element_blank(), legend.key=element_blank(), strip.background = element_blank())+
  scale_colour_manual(name = "", values = c("#999999", "#56B4E9")) + # adds the colours for plotting
  #scale_y_continuous(expand=c(0,0), limits = c(-3, 120)) + # makes the y-axis display as $
  theme(axis.text.x = element_text(size = 9.5), axis.title.y = element_text(size = 9.5, hjust = 0.6, vjust = 2.5), legend.position = "bottom", legend.text = element_text(size = 8), legend.key.size = unit(0.4, "cm"), legend.key.height = unit(0.4, "cm")) + #Legend theme
  guides(colour = guide_legend(override.aes = list(shape = 15, size=3))) +
  ylab("AFDW per day (g)") + # y-axis label
  xlab("") +
  ggtitle("Warm Season") 

```

```{r combo and save afdw per day figure}

AlgaeWeight_bootCI <- ggarrange(cool_perday_boot_plot, warm_perday_boot_plot, nrow = 1, labels = c("A", "B "), legend = "bottom", common.legend = TRUE) + 
  theme(plot.background = element_rect(fill = "white", colour = NA))
AlgaeWeight_bootCI

ggsave("FigureS5_AFDWperDay.png", width = 22, height = 10, units = "cm", dpi = 300)

```


## Tables with boot mean and CI

### AFDW GLM and Bootstrap CI

```{r }

## Cool season AFDW bootstrap CIs
mean_AlgaeWeight_Cold2019_boot <- AlgaeWeight_Cold2019_boot%>%
  group_by(Treatment, N)%>%
  summarise(mean = mean(AFDW..g...preburn..postburn.),
            boot_estimate = mean(mean),
            lowerCI = mean(lowerci),
            upperCI = mean(upperci))

mean_AlgaeWeight_Cold2019_boot <- as.data.frame(mean_AlgaeWeight_Cold2019_boot)


## Warm season AFDW bootstrap CIs
mean_AlgaeWeight_Warm2020_boot_fishRM<-AlgaeWeight_Warm2020_boot_fishRM%>%
  group_by(Treatment, N)%>%
  summarise(mean = mean(AFDW..g...preburn..postburn.),
            boot_estimate = mean(mean),
            lowerCI = mean(lowerci),
            upperCI = mean(upperci))

mean_AlgaeWeight_Warm2020_boot_fishRM <- as.data.frame(mean_AlgaeWeight_Warm2020_boot_fishRM)


## Cool season AFDW GLM output table
summary_cold_glm <- data.frame(rownames(summary(cold_glm)$coeff), summary(cold_glm)$coeff)
colnames(summary_cold_glm) <- c("Coefficient", "Estimate", "Std. Error", "t value", "P value")


## Warm season AFDW GLM output table
summary_warm_glm <- data.frame(rownames(summary(warm_glm)$coeff), summary(warm_glm)$coeff)
colnames(summary_warm_glm) <- c("Coefficient", "Estimate", "Std. Error", "t value", "P value")

```

### AFDW per day GLM and Bootstrap CI

```{r }

## Cool season AFDW bootstrap CIs
mean_AlgaeWeight_Cold2019_perday_boot <- AlgaeWeight_Cold2019_perday_boot%>%
  group_by(Treatment, N)%>%
  summarise(mean = mean(AFDW..g...preburn..postburn.),
            boot_estimate = mean(mean),
            lowerCI = mean(lowerci),
            upperCI = mean(upperci))

mean_AlgaeWeight_Cold2019_perday_boot <- as.data.frame(mean_AlgaeWeight_Cold2019_perday_boot)


## Warm season AFDW bootstrap CIs
AlgaeWeight_Warm2020_perday_boot<-AlgaeWeight_Warm2020_perday_boot%>%
  group_by(Treatment, N)%>%
  summarise(mean = mean(AFDW..g...preburn..postburn.),
            boot_estimate = mean(mean),
            lowerCI = mean(lowerci),
            upperCI = mean(upperci))

AlgaeWeight_Warm2020_perday_boot <- as.data.frame(AlgaeWeight_Warm2020_perday_boot)


## Cool season AFDW GLM output table
summary_cool_perday_glm <- data.frame(rownames(summary(cool_perday_glm)$coeff), summary(cool_perday_glm)$coeff)
colnames(summary_cool_perday_glm) <- c("Coefficient", "Estimate", "Std. Error", "t value", "P value")


## Warm season AFDW GLM output table
summary_warm_perday_glm <- data.frame(rownames(summary(warm_perday_glm)$coeff), summary(warm_perday_glm)$coeff)
colnames(summary_warm_perday_glm) <- c("Coefficient", "Estimate", "Std. Error", "t value", "P value")

```


```{r save the tables into an excel spreadsheet]}

### Create workbook
wb <- createWorkbook()

# add 'Table 1' worksheet
addWorksheet(wb, "Cool AFDW Boot") 
writeData(wb, sheet = 1, x = mean_AlgaeWeight_Cold2019_boot)
setColWidths(wb, sheet = 1, cols = 1:6, widths = "auto")

# add 'Table 2' worksheet
addWorksheet(wb, "Warm AFDW Boot") 
writeData(wb, sheet = 2, x = mean_AlgaeWeight_Warm2020_boot_fishRM)
setColWidths(wb, sheet = 2, cols = 1:6, widths = "auto")


# add 'Table 3' worksheet
addWorksheet(wb, "cool glm") 
writeData(wb, sheet = 3, x = summary_cold_glm)
setColWidths(wb, sheet = 3, cols = 1:4, widths = "auto")

# add 'Table 4' worksheet
addWorksheet(wb, "warm glm") 
writeData(wb, sheet = 4, x = summary_warm_glm)
setColWidths(wb, sheet = 4, cols = 1:4, widths = "auto")


# add 'Table 5' worksheet
addWorksheet(wb, "Cool AFDW per day Boot") 
writeData(wb, sheet = 5, x = mean_AlgaeWeight_Cold2019_perday_boot)
setColWidths(wb, sheet = 5, cols = 1:6, widths = "auto")

# add 'Table 6' worksheet
addWorksheet(wb, "Warm AFDW per day Boot") 
writeData(wb, sheet = 6, x = AlgaeWeight_Warm2020_perday_boot)
setColWidths(wb, sheet = 6, cols = 1:6, widths = "auto")


# add 'Table 7' worksheet
addWorksheet(wb, "cool AFDW per day glm") 
writeData(wb, sheet = 7, x = summary_cool_perday_glm)
setColWidths(wb, sheet = 7, cols = 1:4, widths = "auto")

# add 'Table 8' worksheet
addWorksheet(wb, "warm  AFDW per day glm") 
writeData(wb, sheet = 8, x = summary_warm_perday_glm)
setColWidths(wb, sheet = 8, cols = 1:4, widths = "auto")



# save workbook
saveWorkbook(wb, file="StatTables.xlsx", overwrite = TRUE)

```



## Session Information from last knit run:
`r format(Sys.time(), '%d %B %Y')`

```{r session info}

sessionInfo()

```
